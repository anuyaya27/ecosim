<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoSim</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #ffffff;
    }
    header {
      background-color: #013e29;
      color: rgb(255, 255, 255);
      padding: 1rem;
      text-align: center;
    }
    main {
      padding: 2rem;
      max-width: 1100px;
      margin: auto;
    }
    .section {
      margin-bottom: 2rem;
    }
    label {
      font-weight: bold;
    }
    select, input[type="text"] {
      padding: 0.6rem;
      border: 1px solid #013e29;
      border-radius: 10px;
    }
    .dropdown-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: flex-end;
    }
    .dropdown-group {
      display: flex;
      flex-direction: column;
    }
    .graph-container {
      display: flex;
      height: 500px;
      border: 1px solid #000000;
      background-color: #a0f4d2;
      position: relative;
    }
    .sidebar {
      width: 300px;
      background: rgb(255, 255, 255);
      border-right: 1px solid #ccc;
      padding: 1rem;
      overflow-y: auto;
    }
    #graph {
      flex-grow: 1;
      position: relative;
      background: #fff;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    .calc-dropdown {
      margin-bottom: 1rem;
    }
    .btn {
      padding: 0.6rem 1rem;
      background-color: #013e29;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1.25rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>EcoSim360</h1>
  </header>
  <main>
    <div class="section">
      <div class="dropdown-row">
        <div class="dropdown-group">
          <label for="parameter">Select Parameter:</label>
          <select id="parameter">
            <option value="">-- Choose --</option>
            <option value="income">Income</option>
            <option value="tax">Tax Rate</option>
            <option value="UBI">UBI Amount</option>
          </select>
        </div>
        <div class="dropdown-group">
          <label for="model">Select Model:</label>
          <select id="model" disabled>
            <option value="">-- Choose --</option>
          </select>
        </div>
        <div class="dropdown-group">
          <label for="calculation">Potential Calculations:</label>
          <select id="calculation" disabled>
            <option value="">-- Choose --</option>
          </select>
        </div>
        <button class="btn" onclick="simulateGraph()">Simulate Graph</button>
      </div>
    </div>

    <div class="graph-container">
      <div class="sidebar">
        <h3>Equations</h3>
        <div id="equation-list">
          <input type="text" placeholder="Enter equation 1..." />
          <input type="text" placeholder="Enter equation 2..." />
        </div>
        <button class="btn" onclick="addEquation()">+ Add Equation</button>
        <button class="btn" onclick="simulateGraph()">Plot Equations</button>
      </div>
      <div id="graph">
        <div id="graphCanvas" style="width: 100%; height: 100%;"></div>
      </div>
    </div>
  </main>

  <script>
    const parameterSelect = document.getElementById('parameter');
    const modelSelect = document.getElementById('model');
    const calculationSelect = document.getElementById('calculation');

    const modelOptions = {
      income: [
        { value: 'income-linear', text: 'Linear Income Model' },
        { value: 'income-log', text: 'Logarithmic Income Model' }
      ],
      tax: [
        { value: 'tax-flat', text: 'Flat Tax Model' },
        { value: 'tax-progressive', text: 'Progressive Tax Model' }
      ],
      UBI: [
        { value: 'ubi-basic', text: 'Basic UBI Model' },
        { value: 'ubi-conditional', text: 'Conditional UBI Model' }
      ]
    };

    const calculationOptions = {
      income: [
        { value: 'gini', text: 'Gini Coefficient' },
        { value: 'revenue', text: 'Income Tax Revenue' }
      ],
      tax: [
        { value: 'efficiency', text: 'Efficiency Loss' },
        { value: 'revenue', text: 'Tax Revenue' }
      ],
      UBI: [
        { value: 'coverage', text: 'Coverage Rate' },
        { value: 'welfare', text: 'Welfare Gain' }
      ]
    };

    parameterSelect.addEventListener('change', function () {
      const selected = this.value;
      modelSelect.innerHTML = '<option value="">-- Choose --</option>';
      calculationSelect.innerHTML = '<option value="">-- Choose --</option>';

      if (selected && modelOptions[selected]) {
        modelSelect.disabled = false;
        calculationSelect.disabled = false;

        modelOptions[selected].forEach(option => {
          const opt = document.createElement('option');
          opt.value = option.value;
          opt.textContent = option.text;
          modelSelect.appendChild(opt);
        });

        calculationOptions[selected].forEach(option => {
          const opt = document.createElement('option');
          opt.value = option.value;
          opt.textContent = option.text;
          calculationSelect.appendChild(opt);
        });
      } else {
        modelSelect.disabled = true;
        calculationSelect.disabled = true;
      }
    });

    function addEquation() {
      const list = document.getElementById('equation-list');
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Enter another equation...';
      list.appendChild(input);
    }

    function simulateGraph() {
      const equations = document.querySelectorAll('#equation-list input');
      const data = [];

      equations.forEach((input, index) => {
        const rawExpr = input.value.trim();
        if (rawExpr) {
          const expr = rawExpr
            .replace(/(?<!\w)(sin|cos|tan|log|sqrt|exp|abs|PI|E)(?!\w)/g, match => `Math.${match}`);

          const x = [], y = [];
          for (let i = -10; i <= 10; i += 0.5) {
            try {
              const xi = i;
              const yi = new Function('x', `return ${expr}`)(xi);
              if (!isNaN(yi)) {
                x.push(xi);
                y.push(yi);
              }
            } catch (e) {
              console.error(`Invalid equation: "${rawExpr}" â†’ ${e.message}`);
            }
          }

          if (x.length && y.length) {
            data.push({ x, y, type: 'scatter', mode: 'lines', name: `Eq ${index + 1}` });
          }
        }
      });

      Plotly.newPlot('graphCanvas', data, {
        margin: { t: 10 },
        xaxis: { title: 'x' },
        yaxis: { title: 'f(x)' }
      });
    }
  </script>
</body>
</html>